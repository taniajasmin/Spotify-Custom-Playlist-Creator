<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>AI Playlist Generator</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
    :root { --green: #1DB954; --dark: #191414; --light: #f8f8f8; }
    body { font-family: 'Segoe UI', sans-serif; background: var(--light); margin:0; padding:0; color:#333; line-height:1.5; }
    .container { max-width: 640px; margin: 0 auto; padding: 20px; }
    h1 { text-align:center; color: var(--dark); margin-bottom:8px; }
    .subtitle { text-align:center; color:#555; margin-bottom:30px; }
    .progress { height:8px; background:#e0e0e0; border-radius:4px; margin:30px 0; overflow:hidden; }
    .progress-bar { height:100%; background:var(--green); width:0%; transition:width 0.5s; }
    .question { background:white; padding:22px; margin-bottom:22px; border-radius:14px; box-shadow:0 6px 20px rgba(0,0,0,0.08); }
    h3 { margin:0 0 16px 0; color:var(--dark); font-size:18px; }
    label { display:block; padding:14px; margin:7px 0; background:#f9f9f9; border-radius:10px; cursor:pointer; transition:0.2s; border:1px solid #eee; }
    label:hover { background:#f0f0f0; transform:translateY(-1px); }
    input[type="radio"], input[type="checkbox"] { margin-right:12px; transform:scale(1.3); accent-color:var(--green); }
    .checkbox-group { display:grid; grid-template-columns:1fr 1fr; gap:8px; }
    @media (max-width:500px) { .checkbox-group { grid-template-columns:1fr; } }
    textarea { width:100%; padding:14px; border:1px solid #ddd; border-radius:10px; font-family:inherit; font-size:16px; resize:vertical; }
    button[type="submit"] {
        width:100%; padding:18px; background:var(--green); color:white; border:none; border-radius:50px;
        font-size:19px; font-weight:bold; cursor:pointer; margin-top:30px; box-shadow:0 6px 20px rgba(29,185,84,0.3);
    }
    button[type="submit"]:disabled { background:#aaa; }
    .result {
        background:white; padding:30px; border-radius:16px; box-shadow:0 10px 30px rgba(0,0,0,0.12);
        text-align:center; margin-top:40px; display:none;
    }
    .result button {
        background:var(--green); color:white; border:none; padding:16px 40px; font-size:19px;
        border-radius:50px; cursor:pointer; margin-top:20px; font-weight:bold;
    }
    .scores { margin-top:20px; font-size:15px; color:#666; }
</style>
</head>
<body>

<div class="container">
    <h1>AI Playlist Generator</h1>
    <p class="subtitle">10 quick questions → your perfect Spotify party playlist</p>
    <div class="progress"><div class="progress-bar" id="progress"></div></div>

    <form id="quiz">

        <!-- Q1 -->
        <div class="question">
            <h3>1. What kind of event are you planning?</h3>
            <label><input type="radio" name="q1" value="Wedding (Evening party)" required> Wedding – Evening party</label>
            <label><input type="radio" name="q1" value="Wedding (Drinks reception)"> Wedding – Drinks reception / cocktail hour</label>
            <label><input type="radio" name="q1" value="Corporate party / awards"> Corporate party / awards night</label>
            <label><input type="radio" name="q1" value="Private party / milestone"> Private party / birthday / milestone</label>
            <label><input type="radio" name="q1" value="Black-tie gala"> Black-tie gala / formal event</label>
        </div>

        <!-- Q2 -->
        <div class="question">
            <h3>2. Choose your overall vibe</h3>
            <label><input type="radio" name="q2" value="Elegant & modern" required> Elegant & modern</label>
            <label><input type="radio" name="q2" value="Fun & nostalgic"> Fun & nostalgic</label>
            <label><input type="radio" name="q2" value="High-energy floorfillers"> High-energy floorfillers</label>
            <label><input type="radio" name="q2" value="Ibiza sunset & house"> Ibiza sunset & house</label>
            <label><input type="radio" name="q2" value="Indie/cool & alternative"> Indie / cool / alternative</label>
        </div>

        <!-- Q3 -->
        <div class="question">
            <h3>3. Pick a drinks moment that fits</h3>
            <label><input type="radio" name="q3" value="Champagne tower" required> Champagne tower</label>
            <label><input type="radio" name="q3" value="Espresso martinis"> Espresso martinis</label>
            <label><input type="radio" name="q3" value="Craft cocktails"> Craft cocktails / mixology</label>
            <label><input type="radio" name="q3" value="Pints with pals"> Pints with pals</label>
            <label><input type="radio" name="q3" value="Rosé on the terrace"> Rosé on the terrace</label>
        </div>

        <!-- Q4 -->
        <div class="question">
            <h3>4. Your crowd’s sweet spot</h3>
            <label><input type="radio" name="q4" value="18–25" required> 18–25</label>
            <label><input type="radio" name="q4" value="26–35"> 26–35</label>
            <label><input type="radio" name="q4" value="36–45"> 36–45</label>
            <label><input type="radio" name="q4" value="46–60"> 46–60</label>
            <label><input type="radio" name="q4" value="Mixed ages"> Mixed ages</label>
        </div>

        <!-- Q5 -->
        <div class="question">
            <h3>5. Pick a guaranteed floorfiller</h3>
            <label><input type="radio" name="q5" value="ABBA – Gimme! Gimme! Gimme!" required> ABBA – Gimme! Gimme! Gimme!</label>
            <label><input type="radio" name="q5" value="Calvin Harris – This Is What You Came For"> Calvin Harris – This Is What You Came For</label>
            <label><input type="radio" name="q5" value="Dua Lipa – Levitating"> Dua Lipa – Levitating</label>
            <label><input type="radio" name="q5" value="Queen – Don’t Stop Me Now"> Queen – Don’t Stop Me Now</label>
            <label><input type="radio" name="q5" value="Fleetwood Mac – Everywhere"> Fleetwood Mac – Everywhere</label>
        </div>

        <!-- Q6 -->
        <div class="question">
            <h3>6. Sax on the night?</h3>
            <label><input type="radio" name="q6" value="Absolutely — feature it" required> Absolutely — feature it</label>
            <label><input type="radio" name="q6" value="Nice as an add-on"> Nice as an add-on</label>
            <label><input type="radio" name="q6" value="Not essential"> Not essential</label>
        </div>

        <!-- Q7 -->
        <div class="question">
            <h3>7. Decade flavour (select all that apply)</h3>
            <div class="checkbox-group">
                <label><input type="checkbox" name="q7" value="70s"> 70s</label>
                <label><input type="checkbox" name="q7" value="80s"> 80s</label>
                <label><input type="checkbox" name="q7" value="90s"> 90s</label>
                <label><input type="checkbox" name="q7" value="00s"> 00s</label>
                <label><input type="checkbox" name="q7" value="10s/Now"> 10s / Current hits</label>
            </div>
        </div>

        <!-- Q8 -->
        <div class="question">
            <h3>8. Genre lean (choose up to 2)</h3>
            <div class="checkbox-group">
                <label><input type="checkbox" name="q8" value="Pop/Disco/Dance Classics"> Pop/Disco/Dance Classics</label>
                <label><input type="checkbox" name="q8" value="House/Euphoric vocals"> House / Euphoric vocals</label>
                <label><input type="checkbox" name="q8" value="R&B/Hip-Hop Throwbacks"> R&B / Hip-Hop Throwbacks</label>
                <label><input type="checkbox" name="q8" value="Indie/Alt party tunes"> Indie / Alt party tunes</label>
                <label><input type="checkbox" name="q8" value="Chart/Top 40 only"> Chart / Top 40 only</label>
            </div>
        </div>

        <!-- Q9 -->
        <div class="question">
            <h3>9. How wild should the last hour be?</h3>
            <label><input type="radio" name="q9" value="Smooth & chic" required> Smooth & chic</label>
            <label><input type="radio" name="q9" value="Warm & lively"> Warm & lively</label>
            <label><input type="radio" name="q9" value="Up and bouncing"> Up and bouncing</label>
            <label><input type="radio" name="q9" value="Lose our minds"> Lose our minds!</label>
        </div>

        <!-- Q10 -->
        <div class="question">
            <h3>10. Any firm “do-not-plays”? (optional)</h3>
            <textarea name="q10" rows="3" placeholder="e.g. no Ed Sheeran, no country, no slow ballads, no 2010s trap..."></textarea>
        </div>

        <!-- Song Count (Moved Inside Form) -->
        <div class="question">
            <h3>How many songs?</h3>
            <label><input type="radio" name="song_count" value="15" checked required> 15 songs (perfect for receptions)</label>
            <label><input type="radio" name="song_count" value="50"> 50 songs (full night party)</label>
        </div>

        <!-- SINGLE SUBMIT BUTTON -->
        <button type="submit">Create My Spotify Playlist</button>

    </form>

    <div class="result" id="result">
        <h2 id="title">Your Playlist Is Ready!</h2>
        <p style="font-size:20px; margin:15px 0;"><strong>Vibe:</strong> <span id="vibe" style="color:var(--green);"></span></p>
        <p id="desc" style="font-size:17px; line-height:1.6;"></p>
        <a id="spotifyLink" target="_blank">
            <button>Open in Spotify</button>
        </a>
        <div class="scores" id="scores"></div>
    </div>
</div>

<script>
const form = document.getElementById('quiz');
const progressBar = document.getElementById('progress');

form.oninput = () => {
    const checked = form.querySelectorAll('input[type="radio"]:checked, input[type="checkbox"]:checked').length;
    const filledText = form.querySelector('textarea').value.trim() ? 1 : 0;
    const percent = Math.min(100, ((checked + filledText) / 10) * 100);
    progressBar.style.width = percent + '%';
};

form.onsubmit = async (e) => {
    e.preventDefault();
    const btn = e.target.querySelector('button[type="submit"]');
    btn.disabled = true;
    btn.textContent = 'Creating…';

    const fd = new FormData(form);
    const res = await fetch('/quiz/submit', { method: 'POST', body: fd });
    const json = await res.json();

    const result = document.getElementById('result');

    if (!json.success) {
        result.innerHTML = `<h2>Error</h2><p>${json.error || 'Failed'}</p>`;
    } else {
        const p = json.playlist;
        const v = json.vibe_details;

        document.getElementById('title').innerHTML = `
            <strong>${p.title}</strong><br>
            <small>${p.song_count} songs • ${p.vibe}</small>
        `;
        document.getElementById('vibe').textContent = p.vibe;
        document.getElementById('desc').textContent = p.description;
        document.getElementById('spotifyLink').href = p.spotify_url;
        document.getElementById('scores').textContent =
            `Energy: ${v.scores.E} • Modern: ${v.scores.M} • Nostalgia: ${v.scores.N}`;

        result.style.display = 'block';
        result.scrollIntoView({behavior: 'smooth'});
    }

    btn.disabled = false;
    btn.textContent = 'Create My Spotify Playlist';
};
</script>

</body>
</html>
